<html>
	<head>
		<title>Dina mobile - Selecione a Empresa</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="./css/mobile.css">
		<script type="text/javascript" src="./js/global.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	</head>
	<body>
		<div class="limiter">
			<!-- Menu fixado no topo da página -->
			<div class="navbar">
				<!-- Menu hamburger -->
				<a href="" id="menu">
					<div class="menu-hamb"></div>
					<div class="menu-hamb"></div>
					<div class="menu-hamb"></div>
				</a>
				<!-- Ícone do usuário -->
				<a href="" id="icon">
					<div class="user-picture"></div>
				</a>
			</div>
			<div class="container">
				<!-- Título fixado no topo da lista  -->
				<div class="title">Selecione a empresa:</div>
				<!-- Encapsulador de conteúdo  -->
				<div class="content">
					<!-- Lista de empresas que o usuário tem acesso  -->
					<ul class="orga-list">
						<!-- <li class="orga-item" data-id="1">
							<div class="img-wrap">
								<img src="./img/300000.png" alt="logo Dinamize" />
							</div>
							<span class="">Dinamize</span>
						</li> -->
					</ul>
				</div>
			</div>
		</div>
	</body>
	<script>
	$(document).ready( function() {
		//BUSCA INFO DO USUARIO
		$.ajax({
		    url: 'http://passport.alexandre.dev.com/user/get',
		    headers: {
		    	"Content-Type": "application/json; charset=utf-8",
		    	"auth-token": sessionStorage.getItem("utoken"),
		    },
		    data: {},
		    type: 'POST',		    
		    success: function(response) {
				console.log(response);
				$("#user").html(response.body["name"]);
		    },
		    error: function(response) {
		    	console.log('Failed!');
		    	console.log(response);
		    },
		});
		//BUSCA LISTA DE CLIENTES
		$.ajax({
		    url: 'http://passport.alexandre.dev.com/client/search',
		    headers: {
		    	"Content-Type": "application/json; charset=utf-8",
		    	"auth-token": sessionStorage.getItem("utoken"),
		    },
		    data: {},
		    type: 'POST',		    
		    success: function(response) {
				console.log(response);
				var listaClientes = response.body["items"];
				$(".orga-list").html("");
				for(x in listaClientes){
					var client_code = listaClientes[x]["client_code"];
					var client_name = listaClientes[x]["trade_name"];
					$(".orga-list").append("<li class='orga-item' data-id='"+client_code+"'>" +
						"<div class='img-wrap'>" +
							"<span class='helper'></span><img src='./img/"+client_code+".png' alt='"+client_name+"' />" +
						"</div>" +
						"<span class=''>"+client_name+"</span>" +
					"</li>");
			    }
		    },
		    error: function(response) {
				console.log('Failed!');
				console.log(response);
		    },
		});
	});
</script>
</html>